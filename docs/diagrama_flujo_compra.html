<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zonix Eats - Diagrama de Flujo del Ciclo de Compra</title>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
      background: #f5f7f8;
      color: #1e293b;
    }
    h1 { color: #0f172a; margin-bottom: 8px; }
    h2 {
      color: #334155;
      margin-top: 40px;
      padding-bottom: 8px;
      border-bottom: 2px solid #3399ff;
    }
    .diagram {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin: 20px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      overflow-x: auto;
    }
    .mermaid { text-align: center; }
    .subtitle { color: #64748b; margin-bottom: 24px; }
    nav {
      position: fixed;
      top: 16px;
      right: 16px;
      background: white;
      padding: 12px 20px;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.1);
      z-index: 100;
    }
    nav a {
      display: block;
      color: #3399ff;
      text-decoration: none;
      padding: 4px 0;
      font-size: 14px;
    }
    nav a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <nav>
    <strong>Navegar</strong>
    <a href="#diagrama1">1. Flujo general compra</a>
    <a href="#diagrama2">2. Estados de la orden</a>
    <a href="#diagrama3">3. Comprador (paso a paso)</a>
    <a href="#diagrama4">4. Comercio</a>
    <a href="#diagrama5">5. Delivery</a>
    <a href="#diagrama6">6. Admin</a>
    <a href="#diagrama7">7. Secuencia temporal</a>
  </nav>

  <h1>Zonix Eats â€“ Diagrama de Flujo del Ciclo de Compra</h1>
  <p class="subtitle">Ciclo completo desde el inicio hasta la entrega Â· 4 niveles (Comprador, Comercio, Delivery, Admin)</p>

  <h2 id="diagrama1">1. Flujo general de una compra (inicio a fin)</h2>
  <div class="diagram">
    <div class="mermaid">
flowchart TB
    subgraph NIVEL_0["ðŸ›’ NIVEL 0: COMPRADOR"]
        A1[ProductsPage / RestaurantsPage]
        A2[ProductDetailPage / RestaurantDetailsPage]
        A3[CartPage]
        A4[CheckoutPage]
        A5[OrdersPage]
        A6[Order Detail / Tracking]
        
        A1 -->|Tap producto| A2
        A2 -->|Agregar al carrito| A3
        A3 -->|Ir a pagar| A4
        A4 -->|Confirmar compra| A5
        A5 -->|Tap orden| A6
    end
    
    subgraph NIVEL_1["ðŸª NIVEL 1: COMERCIO"]
        B1[CommerceDashboardPage]
        B2[CommerceOrdersPage]
        B3[CommerceOrderDetailPage]
        
        B1 -->|Ver ordenes| B2
        B2 -->|Tap orden| B3
    end
    
    subgraph NIVEL_2["ðŸš´ NIVEL 2: DELIVERY"]
        C1[DeliveryOrdersPage]
        C2[Detalle orden / Aceptar]
        
        C1 --> C2
    end
    
    subgraph NIVEL_4["ðŸ‘‘ NIVEL 4: ADMIN"]
        D1[AdminDashboardPage]
    end
    
    A4 -->|POST /orders| E[(Backend: Orden pending_payment)]
    E --> B2
    B3 -->|Validar pago| F[(paid)]
    B3 -->|En preparacion| G[(processing)]
    B3 -->|Enviar| H[(shipped)]
    H --> C1
    C2 -->|Entregar| I[(delivered)]
    I --> A5
    </div>
  </div>

  <h2 id="diagrama2">2. Estados de la orden</h2>
  <div class="diagram">
    <div class="mermaid">
stateDiagram-v2
    [*] --> pending_payment: Cliente confirma compra
    pending_payment --> paid: Comercio valida comprobante
    pending_payment --> cancelled: Timeout 5 min / Cliente cancela
    paid --> processing: Comercio: En preparacion
    paid --> cancelled: Comercio cancela
    processing --> shipped: Comercio: Enviar
    processing --> cancelled: Comercio cancela
    shipped --> delivered: Delivery: Entregar
    delivered --> [*]: Cliente califica
    cancelled --> [*]
    </div>
  </div>

  <h2 id="diagrama3">3. Comprador â€“ flujo paso a paso</h2>
  <div class="diagram">
    <div class="mermaid">
flowchart LR
    subgraph Entrada
        P1[ProductsPage]
        P2[RestaurantsPage]
    end
    subgraph Busqueda
        D1[ProductDetailPage]
        D2[RestaurantDetailsPage]
    end
    subgraph Carrito
        C1[CartPage]
        C2[CheckoutPage]
    end
    subgraph Post_compra
        O1[OrdersPage]
        O2[Order Detail]
    end
    P1 --> D1
    P2 --> D2
    D1 --> C1
    D2 --> C1
    C1 --> C2
    C2 --> O1
    O1 --> O2
    </div>
  </div>

  <h2 id="diagrama4">4. Comercio</h2>
  <div class="diagram">
    <div class="mermaid">
flowchart LR
    subgraph Dashboard
        D[CommerceDashboardPage]
    end
    subgraph Ordenes
        O1[CommerceOrdersPage]
        O2[CommerceOrderDetailPage]
    end
    subgraph Otras
        P[CommerceProductsPage]
        R[CommerceReportsPage]
    end
    D --> O1
    O1 --> O2
    O2 -->|Validar pago| O2
    O2 -->|En preparacion| O2
    O2 -->|Enviar| O2
    </div>
  </div>

  <h2 id="diagrama5">5. Delivery</h2>
  <div class="diagram">
    <div class="mermaid">
flowchart LR
    subgraph Entregas
        D1[DeliveryOrdersPage]
        D2[Detalle orden]
    end
    subgraph Otras
        H[DeliveryHistoryPage]
        R[DeliveryRoutesPage]
        E[DeliveryEarningsPage]
    end
    D1 --> D2
    D2 -->|Aceptar| D2
    D2 -->|Entregar| D2
    </div>
  </div>

  <h2 id="diagrama6">6. Admin</h2>
  <div class="diagram">
    <div class="mermaid">
flowchart LR
    subgraph Admin
        A1[AdminDashboardPage]
        A2[AdminUsersPage]
        A3[AdminSecurityPage]
        A4[AdminAnalyticsPage]
    end
    A1 --> A2
    A1 --> A3
    A1 --> A4
    </div>
  </div>

  <h2 id="diagrama7">7. Secuencia temporal â€“ Compra de principio a fin</h2>
  <div class="diagram">
    <div class="mermaid">
sequenceDiagram
    participant B as Comprador
    participant C as Comercio
    participant D as Delivery
    participant API as Backend

    B->>API: POST /orders
    API-->>B: Orden pending_payment
    Note over B: OrdersPage muestra nueva orden
    B->>B: Sube comprobante
    C->>CommerceOrdersPage: Ve orden pendiente
    C->>CommerceOrderDetailPage: Abre orden
    C->>API: Validar pago
    API-->>C: paid
    C->>API: PUT processing
    C->>API: PUT shipped
    API-->>D: Asigna a delivery
    D->>DeliveryOrdersPage: Ve orden asignada
    D->>API: PUT delivered
    API-->>B: Notificacion Pusher
    B->>OrdersPage: Ve orden entregada
    B->>API: Crea review
    </div>
  </div>

  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'default',
      flowchart: { useMaxWidth: true, htmlLabels: true },
      sequence: { useMaxWidth: true }
    });
  </script>
</body>
</html>
